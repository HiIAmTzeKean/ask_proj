{% extends 'base.html' %}

{% block title %}Status{% endblock %}

{% block content %}
<div>
    <h4>Class of {{ dojoName }}</h4>
    <h4>Instructor: {{ instructorName }}</h4>
    <h4>Date: {{ lessonDate }}</h4>
</div>

<a href="{{ url_for('attendance.attendanceStatusSummary') }}" class="btn btn-primary">End Class</a>

<hr>

<!--Include remarks for the lesson-->
<div>
    <p>text box here to include techniques taught</p>
</div>

<hr>

<div>
    <table class="table table-sm table-bordered">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Present</th>
                <th scope="col" colspan="2">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for studentstatus in student_list %}
            <tr id="section{{ studentstatus.student_id }}">
                <td>{{ studentstatus.student.firstName }}</td>
                <td>{{ studentstatus.status }}</td>
            
                {% if studentstatus.status != True %}
                <td colspan="2" class="table-danger">
                    <button class="btn btn-success updateButton" student_id="{{ studentstatus.student_id }}"
                        lesson_id="{{ lessonRecord.id }}" status="True">Mark present</button>
                </td>
                {% else %}
                <td colspan="2" class="table-success">
                    <button class="btn btn-danger updateButton" student_id={{ studentstatus.student_id }} lesson_id={{
                        lessonRecord.id }} status="False">Mark absent</button>
                </td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}


{% block scripts %}
<script>
$(document).ready(function() {
    $(document).on('click', '.updateButton', function(){
        var csrf_token = "{{ csrf_token() }}";
        var student_id = $(this).attr('student_id');
        var status = $(this).attr('status');
        var lesson_id = $(this).attr('lesson_id');
    
        $.ajax({
          url: "{{ url_for('attendance.attendancePresent')}}",
          type: "POST",
          headers: {"X-CSRFToken": csrf_token,},
          data: {student_id: student_id, status: status, lesson_id: lesson_id},
          success: function(data){
            $('#section'+student_id).fadeOut(100).fadeIn(100)
            $('#section'+student_id).html(data)
          }
        });
    });
});
</script>
{% endblock %} 
